# 云端办小助手 - 配置说明

## 📱 问题1：政务微信无法打开

### 症状
- 点击"开始运行"后，无法自动打开政务微信
- 或者打开了错误的应用

### 原因
公安内网版政务微信的包名可能与默认的企业微信包名不同。

### 解决方案

#### 方法1：在应用中配置包名（推荐）

1. 打开云端办小助手应用
2. 在主界面找到"政务微信包名"输入框（民警选择下方）
3. 输入正确的包名，应用会自动保存

**常见包名**：
- 企业微信（默认）：`com.tencent.wework`
- 公安政务微信：请咨询您的IT部门获取

#### 方法2：查找应用包名

如果不知道政务微信的包名，可以使用以下方法查找：

**使用APK提取器**：
1. 在应用商店下载"APK提取器"或类似工具
2. 找到政务微信应用
3. 查看应用详情，包名会显示在应用信息中

**使用开发者工具**：
1. 打开手机的"开发者选项"
2. 连接电脑，使用ADB命令：
   ```bash
   adb shell pm list packages | grep wework
   # 或
   adb shell pm list packages | grep weixin
   ```

## 📐 问题2：OCR识别位置不准确

### 症状
- OCR无法正确识别车牌信息
- 点击位置不对，点到了错误的按钮
- "未检测到违法车辆信息"错误

### 原因
不同设备的屏幕分辨率不同，导致坐标位置偏移。

### 解决方案

#### 方法1：查看屏幕信息（快速诊断）

1. 打开云端办小助手应用
2. 在主界面民警选择下方，查看"屏幕分辨率"信息
3. 记录您的设备分辨率（例如：1080x2340）

**说明**：
- 应用已经内置了自动坐标缩放功能
- 默认基准分辨率：1080x2340
- 如果您的分辨率与基准相近，理论上应该可以正常工作

#### 方法2：调整基准分辨率（开发者）

如果您的设备分辨率差异较大，需要重新编译应用：

1. 修改 `CoordinateScaler.kt` 文件：
   ```kotlin
   // 位置：app/src/main/java/com/yuwei/yunduanban/CoordinateScaler.kt
   
   // 将这两个值改为您的设备分辨率
   private const val BASE_WIDTH = 1080   // 改为您的屏幕宽度
   private const val BASE_HEIGHT = 2340  // 改为您的屏幕高度
   ```

2. 重新编译APK：
   ```bash
   ./gradlew assembleDebug
   ```

3. 安装新的APK

#### 方法3：微调OCR区域（高级）

如果坐标缩放后仍不准确，可能需要微调OCR识别区域：

**需要修改的文件**：`YunDuanBanAccessibilityService.kt`

**OCR坐标说明**：
```kotlin
performOCR(x, y, width, height)
// x: 识别区域左上角X坐标
// y: 识别区域左上角Y坐标
// width: 识别区域宽度
// height: 识别区域高度
```

**主要的OCR调用位置**：
```kotlin
// 1. 识别违法车辆信息（政务微信）
val weifacheliang = performOCR(150, 1888, 333, 116)

// 2. 识别"云端办"标题（确认在云端办界面）
val yunduanban = performOCR(450, 128, 165, 75)

// 3. 识别"当场处罚预览"标题（确认在预览界面）
val dangchangchufayulan = performOCR(324, 128, 502, 73)
```

## 🔍 调试技巧

### 查看日志
1. 点击"查看日志"按钮
2. 查看OCR识别结果和坐标信息
3. 日志会显示原始坐标和缩放后坐标

### 测试流程
1. 首次使用建议只放1-2条违法信息进行测试
2. 观察每一步的执行情况
3. 如果失败，查看日志确定问题位置

### 常见日志信息
```
✅ 正常启动
📱 屏幕: 1080x2340, 密度: 2.75
📐 坐标缩放器已初始化
   基准: 1080x2340
   当前: 1080x2340
   缩放: X=1.00, Y=1.00

⚠️ 坐标不匹配警告
📱 屏幕: 1440x3200, 密度: 3.5
📐 坐标缩放器已初始化
   基准: 1080x2340
   当前: 1440x3200
   缩放: X=1.33, Y=1.37
```

## 📞 需要帮助？

如果以上方法都无法解决您的问题，请：

1. **收集信息**：
   - 您的设备型号和Android版本
   - 屏幕分辨率（在应用中查看）
   - 政务微信包名
   - 日志信息（点击"查看日志"→"复制日志"）

2. **联系支持**：
   - 提交GitHub Issue
   - 或联系开发者

## 🎯 快速检查清单

启动前请确认：

- [ ] 无障碍服务已开启
- [ ] 政务微信包名正确配置
- [ ] 屏幕分辨率信息已显示
- [ ] 已登录黄盾云端办模块
- [ ] 政务微信有待处理的违法信息
- [ ] 屏幕保持常亮

---

**更新日期**: 2025-01-19  
**版本**: v2.2.0  
**作者**: 新质战斗力未来中心
